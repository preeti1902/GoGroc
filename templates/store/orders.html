{% extends "base/base.html" %} 
{% block head %}
<link rel="stylesheet" href="/media/css/orders.css" />
{% endblock head %} 
{% block main %}
<div class="container">
        <div class="header">
            <h1>üõí Order History</h1>
            <p>Track and manage all your grocery orders</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3 id="total-orders">0</h3>
                <p>Total Orders</p>
            </div>
            <div class="stat-card">
                <h3 id="delivered-orders">0</h3>
                <p>Delivered</p>
            </div>
            <div class="stat-card">
                <h3 id="pending-orders">0</h3>
                <p>Pending</p>
            </div>
            <div class="stat-card">
                <h3 id="total-savings">‚Çπ0</h3>
                <p>Total Savings</p>
            </div>
        </div>

        <div class="controls">
            <div class="search-container">
                <input type="text" class="search-input" id="search-input" placeholder="Search by order ID, customer name, or product...">
                <span class="search-icon">üîç</span>
            </div>
            <div class="filter-container">
                <select class="filter-select" id="status-filter">
                    <option value="">All Status</option>
                    <option value="delivered">Delivered</option>
                    <option value="pending">Pending</option>
                    <option value="processing">Processing</option>
                    <option value="cancelled">Cancelled</option>
                </select>
                <select class="filter-select" id="date-filter">
                    <option value="">All Time</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                </select>
            </div>
        </div>

        <div class="orders-table-container">
            <table class="orders-table">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Customer</th>
                        <th>Product</th>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="orders-tbody">
                </tbody>
            </table>
        </div>

        <div class="pagination" id="pagination"></div>
    </div>

    <script>
        // Sample orders data
        const ordersData = [
            {
                id: 'ORD-001',
                customer: 'John Smith',
                email: 'john@example.com',
                product: 'Fresh Vegetables & Fruits',
                date: '2024-12-15',
                amount: 899.99,
                savings: 150.00,
                status: 'delivered',
                address: '123 Main St, Mumbai, MH 400001',
                phone: '+91 98765 43210'
            },
            {
                id: 'ORD-002',
                customer: 'Sarah Johnson',
                email: 'sarah@example.com',
                product: 'Rice & Pulses Combo',
                date: '2024-12-14',
                amount: 1299.99,
                savings: 200.00,
                status: 'processing',
                address: '456 Oak Ave, Delhi, DL 110001',
                phone: '+91 87654 32109'
            },
            {
                id: 'ORD-003',
                customer: 'Mike Wilson',
                email: 'mike@example.com',
                product: 'Dairy Products Pack',
                date: '2024-12-13',
                amount: 599.99,
                savings: 75.00,
                status: 'pending',
                address: '789 Pine St, Bangalore, KA 560001',
                phone: '+91 76543 21098'
            },
            {
                id: 'ORD-004',
                customer: 'Emma Brown',
                email: 'emma@example.com',
                product: 'Organic Grains & Cereals',
                date: '2024-12-12',
                amount: 799.99,
                savings: 120.00,
                status: 'delivered',
                address: '321 Elm St, Chennai, TN 600001',
                phone: '+91 65432 10987'
            },
            {
                id: 'ORD-005',
                customer: 'David Lee',
                email: 'david@example.com',
                product: 'Fresh Meat & Seafood',
                date: '2024-12-11',
                amount: 1499.99,
                savings: 300.00,
                status: 'cancelled',
                address: '654 Maple Ave, Hyderabad, TS 500001',
                phone: '+91 54321 09876'
            },
            {
                id: 'ORD-006',
                customer: 'Lisa Garcia',
                email: 'lisa@example.com',
                product: 'Spices & Condiments',
                date: '2024-12-10',
                amount: 349.99,
                savings: 50.00,
                status: 'delivered',
                address: '987 Cedar Ln, Pune, MH 411001',
                phone: '+91 43210 98765'
            },
            {
                id: 'ORD-007',
                customer: 'Robert Taylor',
                email: 'robert@example.com',
                product: 'Beverages & Juices',
                date: '2024-12-09',
                amount: 459.99,
                savings: 80.00,
                status: 'processing',
                address: '147 Birch St, Kolkata, WB 700001',
                phone: '+91 32109 87654'
            },
            {
                id: 'ORD-008',
                customer: 'Jennifer Davis',
                email: 'jennifer@example.com',
                product: 'Snacks & Bakery Items',
                date: '2024-12-08',
                amount: 699.99,
                savings: 90.00,
                status: 'pending',
                address: '258 Spruce Ave, Ahmedabad, GJ 380001',
                phone: '+91 21098 76543'
            }
        ];

        let filteredOrders = [...ordersData];
        let currentPage = 1;
        const ordersPerPage = 5;

        // Initialize the page
        function init() {
            updateStats();
            renderOrders();
            setupEventListeners();
        }

        // Update statistics
        function updateStats() {
            const totalOrders = ordersData.length;
            const deliveredOrders = ordersData.filter(order => order.status === 'delivered').length;
            const pendingOrders = ordersData.filter(order => order.status === 'pending').length;
            const totalSavings = ordersData.reduce((sum, order) => sum + order.savings, 0);

            document.getElementById('total-orders').textContent = totalOrders;
            document.getElementById('delivered-orders').textContent = deliveredOrders;
            document.getElementById('pending-orders').textContent = pendingOrders;
            document.getElementById('total-savings').textContent = `‚Çπ${totalSavings.toFixed(2)}`;
        }

        // Render orders table
        function renderOrders() {
            const tbody = document.getElementById('orders-tbody');
            const startIndex = (currentPage - 1) * ordersPerPage;
            const endIndex = startIndex + ordersPerPage;
            const ordersToShow = filteredOrders.slice(startIndex, endIndex);

            if (ordersToShow.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="no-orders">No orders found</td></tr>';
                return;
            }

            tbody.innerHTML = ordersToShow.map(order => `
                <tr>
                    <td><strong>${order.id}</strong></td>
                    <td>${order.customer}</td>
                    <td>${order.product}</td>
                    <td>${formatDate(order.date)}</td>
                    <td><strong>‚Çπ${order.amount.toFixed(2)}</strong></td>
                    <td><span class="status ${order.status}">${order.status}</span></td>
                    <td>
                        <button class="action-btn view-btn" onclick="viewOrder('${order.id}')">üëÅÔ∏è</button>
                    </td>
                </tr>
            `).join('');

            renderPagination();
        }

        // Render pagination
        function renderPagination() {
            const totalPages = Math.ceil(filteredOrders.length / ordersPerPage);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `<button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>`;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHTML += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += '<span>...</span>';
                }
            }
            
            // Next button
            paginationHTML += `<button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>`;
            
            pagination.innerHTML = paginationHTML;
        }

        // Change page
        function changePage(page) {
            const totalPages = Math.ceil(filteredOrders.length / ordersPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderOrders();
            }
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // Filter orders
        function filterOrders() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;
            const dateFilter = document.getElementById('date-filter').value;

            filteredOrders = ordersData.filter(order => {
                const matchesSearch = order.id.toLowerCase().includes(searchTerm) ||
                                    order.customer.toLowerCase().includes(searchTerm) ||
                                    order.product.toLowerCase().includes(searchTerm);
                
                const matchesStatus = !statusFilter || order.status === statusFilter;
                
                let matchesDate = true;
                if (dateFilter) {
                    const orderDate = new Date(order.date);
                    const today = new Date();
                    
                    switch (dateFilter) {
                        case 'today':
                            matchesDate = orderDate.toDateString() === today.toDateString();
                            break;
                        case 'week':
                            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                            matchesDate = orderDate >= weekAgo;
                            break;
                        case 'month':
                            const monthAgo = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
                            matchesDate = orderDate >= monthAgo;
                            break;
                    }
                }

                return matchesSearch && matchesStatus && matchesDate;
            });

            currentPage = 1;
            renderOrders();
        }

        // View order - redirect to order details page
        function viewOrder(orderId) {
            // Redirect to order details page with order ID as parameter
            // You can customize this URL based on your routing setup
            window.location.href = `order-details.html?id=${orderId}`;
            
        }

        // Setup event listeners
        function setupEventListeners() {
            const searchInput = document.getElementById('search-input');
            const statusFilter = document.getElementById('status-filter');
            const dateFilter = document.getElementById('date-filter');

            searchInput.addEventListener('input', filterOrders);
            statusFilter.addEventListener('change', filterOrders);
            dateFilter.addEventListener('change', filterOrders);
        }

        // Initialize the application
        init();
    </script>
{% endblock main %}